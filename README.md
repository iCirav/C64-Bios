In dire need of refactoring.  Please ignore, unless you like ugly 6502 code.
